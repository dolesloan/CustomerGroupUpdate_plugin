<?php/** * Created by Bitware Technologies. * User: Shirish V * Date: 24/09/2014 */class Bitware_Customergroup_Model_Observer{	public function customer_update_group(Varien_Event_Observer $observer)	{		$lastIncrementId = Mage::getSingleton('checkout/session')->getLastRealOrderId();		$orders = Mage::getModel('sales/order')->load($lastIncrementId, 'increment_id');		$OrderId = $orders->getId();		$order = Mage::getModel('sales/order')->load($OrderId); //Gets the Last Purchased Order Id.		$items = $order->getAllItems();	// Gets Item Details present in the Order		foreach ($items as $item)		{			$sku = $item->getSku(); // Gets the SKU of the Product.			$product = Mage::getModel('catalog/product');					$productId = $product->getIdBySku($sku);			$products = Mage::getModel('catalog/product')->load($productId);			$IsMemberVal = $products->getIsMember(); // Get Custom Attribute named "Is Member" value of ordered product						if($IsMemberVal == 1)			{				if(Mage::getSingleton('customer/session')->isLoggedIn()) {	// Check if user is logged in									$customerData = Mage::getSingleton('customer/session')->getCustomer();					$resource = Mage::getSingleton('core/resource');					$read = $resource->getConnection('core_read');					$customer_id = $customerData->getId();					$customer_group_id = 4;	// 4 is the group id of WA Member.					$write = $resource->getConnection('core_write');					$query = "UPDATE customer_entity SET group_id = $customer_group_id WHERE entity_id = $customer_id";					$write->query($query); //Updates the Database									}				}		}		return $this;	}}